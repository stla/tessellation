---
title: "The tessellation package"
output: 
  rmarkdown::html_vignette:
    css: vignette.css
vignette: >
  %\VignetteIndexEntry{The tessellation package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(tessellation)
```

# Delaunay tessellation

The main function of the **tessellation** package is `delaunay`. It performs 
the Delaunay tessellation (or triangulation) of a set of points.

Let's try it on a simple figure. We take a regular tetrahedron and we add three 
points at random in its interior:

```{r tetrahedron}
tetrahedron <-
  rbind(
    c(2*sqrt(2)/3, 0, -1/3),
    c(-sqrt(2)/3, sqrt(2/3), -1/3),
    c(-sqrt(2)/3, -sqrt(2/3), -1/3),
    c(0, 0, 1)
  )
library(uniformly)
set.seed(314)
randomPoints <- runif_in_tetrahedron(
  3, tetrahedron[1, ], tetrahedron[2, ], tetrahedron[3, ], tetrahedron[4, ]
)
```

Let's do a function to plot a tetrahedron. We will use it several times.

```{r plotTetrahedronFunction}
library(rgl)
plotTetrahedron <- function(tetrahedron, alpha){
  faces <- combn(4L, 3L)
  for(j in 1L:ncol(faces)){
    triangles3d(tetrahedron[faces[, j], ], color = "orange", alpha = alpha)
  }
  edges <- combn(4L, 2L)
  for(j in 1L:ncol(edges)){
    shade3d(
      cylinder3d(tetrahedron[edges[, j], ], sides = 60, radius = 0.03),
      color = "yellow"
    )
  }
  spheres3d(tetrahedron, radius = 0.05, color = "yellow")
}
```

Here is our tetrahedron with its three additional random points:

```{r tetrahedron_rgl, eval=FALSE}
open3d(windowRect = c(50, 50, 562, 562))
bg3d("slategray")
plotTetrahedron(tetrahedron, alpha = 0.3)
spheres3d(randomPoints, radius = 0.04, color = "black"
```

![](Tetrahedron.gif)

Now let's compute and plot the Delaunay tessellation of these seven points:

```{r tetrahedron_delaunay, eval=FALSE}
library(tessellation)
pts <- rbind(tetrahedron, randomPoints)
del <- delaunay(pts)
open3d(windowRect = c(50, 50, 562, 562))
material3d(lwd = 2)
plotDelaunay3D(del, color=TRUE, luminosity = "bright", alpha=0.5)
```

![](TetrahedronDelaunay.gif)

It is not easy to visualize a 3D Delaunay tessellation. The colors are not 
very helpful. Something which helps a little is to plot the exterior edges as 
tubes. To do so, one firstly has to execute the `delaunay` function with the 
option `exteriorEdges=TRUE`, then one has to run the `plotDelaunay3D` function 
with the option `exteriorEdgesAsTubes=TRUE`:

```{r tetrahedron_delaunay_with_tubes, eval=FALSE}
del <- delaunay(pts, exteriorEdges = TRUE)
open3d(windowRect = c(50, 50, 562, 562))
bg3d("slategray")
material3d(lwd = 2)
plotDelaunay3D(
  del, color=TRUE, luminosity = "bright", alpha = 0.2,
  exteriorEdgesAsTubes = TRUE, tubeRadius = 0.03, tubeColor = "navy"
)
```

![](TetrahedronDelaunayWithTubes.gif)

Let's have a look at each tile, separately:

![](TetrahedronTiles.png)


# Voronoï tessellation

The Delaunay tessellation is mainly implemented in C, with the **Qhull** 
library. The Voronoï tessellation, that we will see now, is derived from the 
Delaunay tessellation and this derivation is implemented in R only.

